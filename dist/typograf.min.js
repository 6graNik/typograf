function Typograf(e){this._prefs="object"==typeof e?e:{},this._settings={},this._enabledRules={},this._initSafeTags(),this._rules.forEach(this._prepareRule,this)}Typograf.rule=function(e){return e.enabled=e.enabled===!1?!1:!0,e._lang=e.name.split("/")[0],e.sortIndex=e.sortIndex||0,Typograf.prototype._rules.push(e),Typograf._needSortRules&&this._sortRules(),this},Typograf.innerRule=function(e){return Typograf.prototype._innerRules.push(e),e._lang=e.name.split("/")[0],e.sortIndex=e.sortIndex||0,Typograf._needSortRules&&this._sortInnerRules(),this},Typograf.data=function(e,n){Typograf.prototype.data[e]=n},Typograf._sortRules=function(){Typograf.prototype._rules.sort(function(e,n){return e.sortIndex>n.sortIndex?1:-1})},Typograf._sortInnerRules=function(){Typograf.prototype._innerRules.sort(function(e,n){return e.sortIndex>n.sortIndex?1:-1})},Typograf.prototype={constructor:Typograf,execute:function(e,n){n=n||{};var r=this,t=n.lang||this._prefs.lang||"common",a={},o={},u="undefined"==typeof n.mode?this._prefs.mode:n.mode,i=function(n){var r=n._lang;"common"!==r&&r!==t||!this.enabled(n.name)||(e=n.func.call(this,e,this._settings[n.name]))},c=function(e){o[e]&&o[e].forEach(i,r),a[e]&&a[e].forEach(i,r)};if(this._lang=t,e=""+e,!e)return"";e=this._fixLineEnd(e),this._innerRules.forEach(function(e){var n=e.queue;o[n]=o[n]||[],o[n].push(e)},this),this._rules.forEach(function(e){var n=e.queue;a[n]=a[n]||[],a[n].push(e)},this),c("start");var l=-1!==e.search(/<[a-z!]/i);return l&&(e=this._hideSafeTags(e)),e=this._utfication(e),c(),e=this._modification(e,u),l&&(e=this._showSafeTags(e)),c("end"),this._lang=null,e},setting:function(e,n,r){return arguments.length<=2?this._settings[e]&&this._settings[e][n]:(this._settings[e]=this._settings[e]||{},this._settings[e][n]=r,this)},enabled:function(e){return this._enabledRules[e]},disabled:function(e){return!this._enabledRules[e]},enable:function(e){return this._enable(e,!0)},disable:function(e){return this._enable(e,!1)},addSafeTag:function(e,n){this._safeTags.push([e,n])},letters:function(){var e=this._lang||this._prefs.lang,n=this.data["common/letter"],r=this.data[e+"/letter"];return n!==r&&e?n+r:n},data:{},_fixLineEnd:function(e){return e.replace(/\r\n/g,"\n").replace(/\r/g,"\n")},_prepareRule:function(e){var n=e.name;this._settings[n]=e.settings||{},this._enabledRules[n]=e.enabled},_enable:function(e,n){return Array.isArray(e)?e.forEach(function(e){this._enableByMask(e,n)},this):this._enableByMask(e,n),this},_enableByMask:function(e,n){var r;-1!==e.search(/\*/)?(r=new RegExp(e.replace(/\//g,"\\/").replace(/\*/g,".*")),this._rules.forEach(function(e){var t=e.name;r.test(t)&&(this._enabledRules[t]=n)},this)):this._enabledRules[e]=n},_rules:[],_innerRules:[],_initSafeTags:function(){this._safeTags=[["<!--","-->"],["<!ENTITY",">"],["<!DOCTYPE",">"],["<\\?xml","\\?>"],["<!\\[CDATA\\[","\\]\\]>"],["<code[^>]*?>","</code>"],["<object[^>]*?","</object>"],["<pre[^>]*?>","</pre>"],["<script[^>]*?>","</script>"],["<style[^>]*?>","</style>"]]},_hideSafeTags:function(e){this._hiddenSafeTags={};var n=this,r=0,t=function(e){var t="__typograf"+r+"__";return n._hiddenSafeTags[t]=e,r++,t};return this._safeTags.forEach(function(n){var r=new RegExp(n[0]+"[^]*?"+n[1],"gi");e=e.replace(r,t)}),e.replace(/<[a-z\/][^>]*?>/gi,t)},_showSafeTags:function(e){for(var n=function(n){e=e.replace(new RegExp(n,"gi"),this._hiddenSafeTags[n])},r=0;r<this._safeTags.length&&(Object.keys(this._hiddenSafeTags).forEach(n,this),!(e.search(/__typograf[\d]+__/)<0));r++);return delete this._hiddenSafeTags,e},_utfication:function(e){return-1!==e.search(/&#/)&&(e=this._decHexToUtf(e)),-1!==e.search(/&[a-z]/i)&&this.entities.forEach(function(n){e=e.replace(n[3],n[2])}),e},_decHexToUtf:function(e){return e.replace(/&#(\d{1,6});/gi,function(e,n){return String.fromCharCode(parseInt(n,10))}).replace(/&#x([\da-f]{1,6});/gi,function(e,n){return String.fromCharCode(parseInt(n,16))})},_modification:function(e,n){if("name"===n||"digit"===n){var r="name"===n?0:1;this.entities.forEach(function(n){n[r]&&(e=e.replace(n[4],n[r]))})}return e}},"object"==typeof exports&&(module.exports=Typograf),Typograf.prototype.entities=[],[["nbsp",160],["iexcl",161],["cent",162],["pound",163],["curren",164],["yen",165],["brvbar",166],["sect",167],["uml",168],["copy",169],["ordf",170],["laquo",171],["not",172],["shy",173],["reg",174],["macr",175],["deg",176],["plusmn",177],["sup2",178],["sup3",179],["acute",180],["micro",181],["para",182],["middot",183],["cedil",184],["sup1",185],["ordm",186],["raquo",187],["frac14",188],["frac12",189],["frac34",190],["iquest",191],["Agrave",192],["Aacute",193],["Acirc",194],["Atilde",195],["Auml",196],["Aring",197],["AElig",198],["Ccedil",199],["Egrave",200],["Eacute",201],["Ecirc",202],["Euml",203],["Igrave",204],["Iacute",205],["Icirc",206],["Iuml",207],["ETH",208],["Ntilde",209],["Ograve",210],["Oacute",211],["Ocirc",212],["Otilde",213],["Ouml",214],["times",215],["Oslash",216],["Ugrave",217],["Uacute",218],["Ucirc",219],["Uuml",220],["Yacute",221],["THORN",222],["szlig",223],["agrave",224],["aacute",225],["acirc",226],["atilde",227],["auml",228],["aring",229],["aelig",230],["ccedil",231],["egrave",232],["eacute",233],["ecirc",234],["euml",235],["igrave",236],["iacute",237],["icirc",238],["iuml",239],["eth",240],["ntilde",241],["ograve",242],["oacute",243],["ocirc",244],["otilde",245],["ouml",246],["divide",247],["oslash",248],["ugrave",249],["uacute",250],["ucirc",251],["uuml",252],["yacute",253],["thorn",254],["yuml",255],["fnof",402],["Alpha",913],["Beta",914],["Gamma",915],["Delta",916],["Epsilon",917],["Zeta",918],["Eta",919],["Theta",920],["Iota",921],["Kappa",922],["Lambda",923],["Mu",924],["Nu",925],["Xi",926],["Omicron",927],["Pi",928],["Rho",929],["Sigma",931],["Tau",932],["Upsilon",933],["Phi",934],["Chi",935],["Psi",936],["Omega",937],["alpha",945],["beta",946],["gamma",947],["delta",948],["epsilon",949],["zeta",950],["eta",951],["theta",952],["iota",953],["kappa",954],["lambda",955],["mu",956],["nu",957],["xi",958],["omicron",959],["pi",960],["rho",961],["sigmaf",962],["sigma",963],["tau",964],["upsilon",965],["phi",966],["chi",967],["psi",968],["omega",969],["thetasym",977],["upsih",978],["piv",982],["bull",8226],["hellip",8230],["prime",8242],["Prime",8243],["oline",8254],["frasl",8260],["weierp",8472],["image",8465],["real",8476],["trade",8482],["alefsym",8501],["larr",8592],["uarr",8593],["rarr",8594],["darr",8595],["harr",8596],["crarr",8629],["lArr",8656],["uArr",8657],["rArr",8658],["dArr",8659],["hArr",8660],["forall",8704],["part",8706],["exist",8707],["empty",8709],["nabla",8711],["isin",8712],["notin",8713],["ni",8715],["prod",8719],["sum",8721],["minus",8722],["lowast",8727],["radic",8730],["prop",8733],["infin",8734],["ang",8736],["and",8743],["or",8744],["cap",8745],["cup",8746],["int",8747],["there4",8756],["sim",8764],["cong",8773],["asymp",8776],["ne",8800],["equiv",8801],["le",8804],["ge",8805],["sub",8834],["sup",8835],["nsub",8836],["sube",8838],["supe",8839],["oplus",8853],["otimes",8855],["perp",8869],["sdot",8901],["lceil",8968],["rceil",8969],["lfloor",8970],["rfloor",8971],["lang",9001],["rang",9002],["spades",9824],["clubs",9827],["hearts",9829],["diams",9830],["loz",9674],["OElig",338],["oelig",339],["Scaron",352],["scaron",353],["Yuml",376],["circ",710],["tilde",732],["ensp",8194],["emsp",8195],["thinsp",8201],["zwnj",8204],["zwj",8205],["lrm",8206],["rlm",8207],["ndash",8211],["mdash",8212],["lsquo",8216],["rsquo",8217],["sbquo",8218],["ldquo",8220],["rdquo",8221],["bdquo",8222],["dagger",8224],["Dagger",8225],["permil",8240],["lsaquo",8249],["rsaquo",8250],["euro",8364]].forEach(function(e){var n=e[0],r=e[1],t=String.fromCharCode(r),a=["&"+n+";","&#"+r+";",t,new RegExp("&"+n+";","g"),new RegExp(t,"g")];Typograf.prototype.entities.push(a)},this),Typograf.data("common/letter","a-z"),Typograf.data("en/letter","a-z"),Typograf.data("ru/letter","а-яё"),Typograf.data("ru/month",["январь","февраль","март","апрель","май","июнь","июль","август","сентябрь","октябрь","ноябрь","декабрь"]),Typograf.data("ru/monthCase",["января","февраля","марта","апреля","мая","июня","июля","августа","сентября","октября","ноября","декабря"]),Typograf.data("ru/shortMonth",["янв","фев","мар","апр","ма[ейя]","июн","июл","авг","сен","окт","ноя","дек"]),Typograf.data("ru/weekday",["понедельник","вторник","среда","четверг","пятница","суббота","воскресенье"]),Typograf.rule({title:"Экранирование HTML",name:"common/html/escape",sortIndex:10,queue:"end",func:function(e){var n={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"};return e.replace(/[&<>"'\/]/g,function(e){return n[e]})},enabled:!1}),Typograf.rule({title:"Замена перевода строки на тег br",name:"common/html/nbr",sortIndex:710,func:function(e){return e.replace(/\n/g,"<br/>")},enabled:!1}),Typograf.rule({title:"Расстановка тегов p и br",name:"common/html/pbr",sortIndex:700,func:function(e){return-1===e.search(/\n/)?e="<p>"+e+"</p>":(e="<p>"+e.replace(/\n\n/g,"</p>\n<p>")+"</p>",e=e.replace(/([^>])\n/g,"$1<br/>\n")),e},enabled:!1}),Typograf.rule({title:"Удаление HTML-тегов",name:"common/html/stripTags",sortIndex:5,queue:"end",func:function(e){return e.replace(/<\/?[^>]+>/g,"")},enabled:!1}),Typograf.rule({title:"Расстановка ссылок",name:"common/html/url",sortIndex:200,func:function(e){var n="(http|https|ftp|telnet|news|gopher|file|wais)://",r="([a-zA-Z0-9/\\n+-=%&:_.~?]+[a-zA-Z0-9#+]*)",t=new RegExp(n+r,"g");return e.replace(t,function(e,n,r){var t=r,a=n+"://"+r,o='<a href="'+a+'">';return"http"===n?(t=t.replace(/^www\./,"").replace(/^([^\/]+)\/$/,"$1"),o+t+"</a>"):o+a+"</a>"})}}),Typograf.rule({title:"Неразрывный пробел между числом и словом",name:"ru/nbsp/afterNumber",sortIndex:615,func:function(e){var n="(^|\\D)(\\d{1,5}) (["+this.letters()+"]{2,})";return e.replace(new RegExp(n,"gi"),"$1$2 $3")}}),Typograf.rule({title:"Неразрывный пробел после §",name:"common/nbsp/afterPara",sortIndex:610,func:function(e){return e.replace(/§ ?(\d|I|V|X)/g,"§ $1")}}),Typograf.rule({title:"Неразрывный пробел после короткого слова",name:"common/nbsp/afterShortWord",sortIndex:590,func:function(e,n){var r=n.lengthShortWord,t="(^| | )(["+this.letters()+"]{1,"+r+"})(\\.?) ",a=new RegExp(t,"gi");return e.replace(a,"$1$2$3 ").replace(a,"$1$2$3 ")},settings:{lengthShortWord:2}}),Typograf.rule({title:"Неразрывный пробел перед последним коротким словом в предложении",name:"common/nbsp/beforeShortLastWord",sortIndex:620,func:function(e,n){var r=n.lengthLastWord,t=new RegExp(" ([\\w]{1,"+r+"})(\\.|\\?|:|!|,)","g");return e.replace(t," $1$2")},settings:{lengthLastWord:3}}),Typograf.rule({title:"Неразрывный пробел перед lpi, dpi",name:"common/nbsp/dpi",sortIndex:1150,func:function(e){return e.replace(/(\d) ?(lpi|dpi)(?!\w)/,"$1 $2")}}),function(){function e(e,n,r,t){return n+r.replace(/([^\u00A0])\u00A0([^\u00A0])/g,"$1 $2")+t}Typograf.rule({title:"Заменять неразрывный пробел на обычный пробел в тегах nowrap и nobr",name:"common/nbsp/nowrap",sortIndex:1400,func:function(n){return n.replace(/(<nowrap>)(.*?)(<\/nowrap>)/g,e).replace(/(<nobr>)(.*?)(<\/nobr>)/g,e)}})}(),Typograf.rule({title:"1/2 → ½, 1/4 → ¼, 3/3 → ¾",name:"common/number/fraction",sortIndex:1120,func:function(e){return e.replace(/(^|\D)1\/2(\D|$)/g,"$1½$2").replace(/(^|\D)1\/4(\D|$)/g,"$1¼$2").replace(/(^|\D)3\/4(\D|$)/g,"$1¾$2")}}),Typograf.rule({title:"+- → ±",name:"common/number/plusMinus",sortIndex:1010,func:function(e){var n=new RegExp("(^| |\\>| )\\+-(\\d)","g");return e.replace(n,"$1±$2").replace(/(^\s*)\+-(\s*$)/g,"$1±$2")}}),Typograf.rule({title:"x → × (10 x 5 → 10×5)",name:"common/number/times",sortIndex:1050,func:function(e){return e.replace(/(\d) ?(x|х) ?(\d)/g,"$1×$3")}}),Typograf.rule({title:"Удаление повтора слова",name:"common/other/repeatWord",sortIndex:1200,func:function(e){var n="(["+this.letters()+"́]+) \\1([;:,.?! \n])";return e.replace(new RegExp(n,"gi"),"$1$2")},enabled:!1}),Typograf.rule({title:"Удаление двойной пунктуации",name:"common/punctuation/delDoublePunctuation",sortIndex:580,func:function(e){return e.replace(/(,|:|;|\?){2,}/g,"$1")}}),Typograf.rule({title:"!! → !",name:"common/punctuation/exclamation",sortIndex:1150,func:function(e){return e.replace(/(^|[^!])!{2}($|[^!])/,"$1!$2").replace(/(^|[^!])!{4}?($|[^!])/,"$1!!!$2")}}),Typograf.rule({title:"!? → ?!",name:"common/punctuation/exclamationQuestion",sortIndex:1140,func:function(e){var n=new RegExp("(^|[^!])!\\?([^?]|$)","g");return e.replace(n,"$1?!$2")}}),Typograf.rule({title:"Три точки на троеточие",name:"common/punctuation/hellip",sortIndex:20,func:function(e){return e.replace(/(^|[^.])\.{3,4}([^.]|$)/g,"$1…$2")}}),Typograf.rule({title:"Пробел после знаков пунктуации",name:"common/space/afterPunctuation",sortIndex:560,func:function(e){return e.replace(/(!|;|\?)([^ _\n\t!;\?\[])/g,"$1 $2").replace(/(\D)(,|:)([^ _\d\n\t!;,\?\.:])/g,"$1$2 $3")}}),Typograf.rule({title:"Удаление пробела перед %, ‰ и ‱",name:"common/space/delBeforePercent",sortIndex:600,func:function(e){return e.replace(/(\d)( |\u00A0)(%|‰|‱)/g,"$1$3")}}),Typograf.rule({title:"Удаление пробелов перед знаками пунктуации",name:"common/space/delBeforePunctuation",sortIndex:550,func:function(e){return e.replace(/ (!|;|,|\?|\.|:)/g,"$1").replace(/\( /g,"(").replace(/([^ ])\(/g,"$1 (").replace(/ \)/g,")").replace(/\)([^!;,\?\.:])/g,") $1")}}),Typograf.rule({title:"Удаление пробелов в начале строки",name:"common/space/delLeadingBlanks",sortIndex:504,func:function(e){return e.replace(/\n[ \t]+/g,"\n")},enabled:!1}),Typograf.rule({title:"Удаление повторяющихся переносов строки (не более двух)",name:"common/space/delRepeatN",sortIndex:545,func:function(e){return e.replace(/\n{3,}/g,"\n\n")}}),Typograf.rule({title:"Удаление повторяющихся пробелов между символами",name:"common/space/delRepeatSpace",sortIndex:540,func:function(e){return e.replace(/([^\n \t])( |\t){2,}([^\n \t])/g,"$1$2$3")}}),Typograf.rule({title:"Удаление пробелов в конце строки",name:"common/space/delTrailingBlanks",sortIndex:505,func:function(e){return e.replace(/[ \t]+\n/g,"\n")}}),Typograf.rule({title:"Замена таба на 4 пробела",name:"common/space/replaceTab",sortIndex:510,func:function(e){return e.replace(/\t/g," ")}}),Typograf.rule({title:"Удаление пробелов и переносов строк в начале текста",name:"common/space/trimLeft",sortIndex:530,func:String.prototype.trimLeft?function(e){return e.trimLeft()}:function(e){return e.replace(/^[\s\uFEFF\xA0]+/g,"")}}),Typograf.rule({title:"Удаление пробелов и переносов строк в конце текста",name:"common/space/trimRight",sortIndex:535,func:String.prototype.trimRight?function(e){return e.trimRight()}:function(e){return e.replace(/[\s\uFEFF\xA0]+$/g,"")}}),Typograf.rule({title:"-> → →, <- → ←",name:"common/sym/arrow",sortIndex:1130,func:function(e){return e.replace(/(^|[^-])->(?!>)/g,"$1→").replace(/(^|[^<])<-(?!-)/g,"$1←")}}),Typograf.rule({title:"Добавление ° к C и F",name:"common/sym/cf",sortIndex:1020,func:function(e){var n=new RegExp('(\\d+)( | )?(C|F)([\\W \\.,:!\\?"\\]\\)]|$)',"g");return e.replace(n,"$1 °$3$4")}}),Typograf.rule({title:"(c) → ©, (tm) → ©, (r) → ™",name:"common/sym/copy",sortIndex:10,func:function(e){return e.replace(/\(r\)/gi,"®").replace(/(copyright )?\((c|с)\)/gi,"©").replace(/\(tm\)/gi,"™")}}),function(){var e="(^| |\\n)",n="( |,|\\.|\\?|:|!|$)";Typograf.rule({title:"Дефис перед то, либо, нибудь, ка, де, кась",name:"ru/dash/to",sortIndex:30,func:function(e){var r=new RegExp("( | ?- ?)(то|либо|нибудь|ка|де|кась)"+n,"g");return e.replace(r,"-$2$3")}}),Typograf.rule({title:"Дефис между из-за",name:"ru/dash/izza",sortIndex:33,func:function(r){var t=new RegExp(e+"(И|и)з за"+n,"g");return r.replace(t,"$1$2з-за$3")}}),Typograf.rule({title:"Дефис между из-под",name:"ru/dash/izpod",sortIndex:35,func:function(r){var t=new RegExp(e+"(И|и)з под"+n,"g");return r.replace(t,"$1$2з-под$3")}}),Typograf.rule({title:"Дефис после кое и кой",name:"ru/dash/koe",sortIndex:38,func:function(r){var t=new RegExp(e+"(К|к)ое\\s([а-яё]{3,})"+n,"g");r=r.replace(t,"$1$2ое-$3$4");var a=new RegExp(e+"(К|к)ой\\s([а-яё]{3,})"+n,"g");return r.replace(a,"$1$2ой-$3$4")}}),Typograf.rule({title:"Дефис между верно-таки и т.д.",name:"ru/dash/taki",sortIndex:39,func:function(e){var r=new RegExp("(верно|довольно|опять|прямо|так|всё|действительно|неужели)\\s(таки)"+n,"g");return e.replace(r,"$1-$2$3")}})}(),Typograf.rule({title:"Дефис на тире",name:"ru/dash/main",sortIndex:620,func:function(e){var n="(-|--|–|—)",r=this.setting("ru/dash/main","dash"),t=new RegExp("( | )"+n+"( |\\n)","g"),a=new RegExp("(^|\n)"+n+"( | )","g"),o=new RegExp("(X|I|V)(?: | )?"+n+"(?: | )?(X|I|V)","g");return e.replace(t," "+r+"$3").replace(a,"$1"+r+" ").replace(o,"$1"+this.setting("ru/dash/main","dashInterval")+"$3")},settings:{dash:"—",dashInterval:"—"}}),Typograf.rule({title:"Тире между месяцами",name:"ru/dash/month",sortIndex:610,func:function(e){var n="("+this.data["ru/month"].join("|")+")",r=new RegExp(n+" ?(-|—) ?"+n,"gi");return e.replace(r,"$1"+this.setting("ru/dash/main","dashInterval")+"$3")}}),Typograf.rule({title:"Тире между днями недели",name:"ru/dash/weekday",sortIndex:600,func:function(e){var n="("+this.data["ru/weekday"].join("|")+")",r=new RegExp(n+" ?(-|—) ?"+n,"gi");return e.replace(r,"$1"+this.setting("ru/dash/main","dashInterval")+"$3")}}),Typograf.rule({title:"Преобразование дат YYYY-MM-DD к виду DD.MM.YYYY",name:"ru/date/main",sortIndex:1300,func:function(e){var n="(-|\\.|\\/)",r="(-|\\/)",t=new RegExp("(^|\\D)(\\d{4})"+n+"(\\d{2})"+n+"(\\d{2})(\\D|$)","gi"),a=new RegExp("(^|\\D)(\\d{2})"+r+"(\\d{2})"+r+"(\\d{4})(\\D|$)","gi");return e.replace(t,"$1$6.$4.$2$7").replace(a,"$1$4.$2.$6$7")}}),Typograf.rule({title:"2 Мая, Понедельник → 2 мая, понедельник",name:"ru/date/weekday",sortIndex:1310,func:function(e){var n="( | )",r=this.data["ru/monthCase"].join("|"),t=this.data["ru/weekday"].join("|"),a=new RegExp("(\\d)"+n+"("+r+"),"+n+"("+t+")","gi");return e.replace(a,function(){var e=arguments;return e[1]+e[2]+e[3].toLowerCase()+","+e[4]+e[5].toLowerCase()})}}),Typograf.rule({title:"$100 → 100 $",name:"ru/money/dollar",sortIndex:1140,func:function(e){var n=new RegExp("(^|[\\D]{2,})\\$ ?([\\d.,]+)","g"),r=new RegExp("(^|[\\D])([\\d.,]+) ?\\$"),t="$1$2 $";return e.replace(n,t).replace(r,t)}}),Typograf.rule({title:"€100 → 100 €",name:"ru/money/euro",sortIndex:1140,func:function(e){var n=new RegExp("(^|[\\D]{2,})€ ?([\\d.]+)","g"),r=new RegExp("(^|[\\D])([\\d.,]+) ?€"),t="$1$2 €";return e.replace(n,t).replace(r,t)}}),Typograf.rule({title:"1 руб. → 1 ₽",name:"ru/money/ruble",sortIndex:1145,func:function(e){var n="$1 ₽";return e.replace(/^(\d+)( |\u00A0)?(р|руб)\.$/,n).replace(/(\d+)( |\u00A0)?(р|руб)\.(?=[!?,:;])/g,n).replace(/(\d+)( |\u00A0)?(р|руб)\.(?=\s+[A-ЯЁ])/g,n+".")},enabled:!1}),Typograf.rule({title:"Неразрывный пробел после №",name:"ru/nbsp/afterNumberSign",sortIndex:610,func:function(e){return e.replace(/№ ?(\d|п\/п)/g,"№ $1")}}),Typograf.rule({title:"Неразрывный пробел перед ли, ль, же, бы, б",name:"ru/nbsp/beforeParticle",sortIndex:570,func:function(e){return e.replace(/ (ли|ль|же|ж|бы|б)([^а-яёА-ЯЁ])/g," $1$2")}}),Typograf.rule({title:"Неразрывный пробел перед последним коротким словом в предложении",name:"ru/nbsp/beforeShortLastWord",sortIndex:620,func:function(e,n){var r=n.lengthLastWord,t=new RegExp(" ([а-яёА-ЯЁ]{1,"+r+"})(\\.|\\?|:|!|,)","g");return e.replace(t," $1$2")},settings:{lengthLastWord:3}}),Typograf.rule({title:"Расстановка запятых и неразрывного пробела перед а и но",name:"ru/nbsp/but",sortIndex:1110,func:function(e){var n=new RegExp(",?( | |\n)(а|но)( | |\n)","g");return e.replace(n,",$1$2$3")}}),Typograf.rule({title:"Удаление пробелов и лишних точек в вв.",name:"ru/nbsp/cc",sortIndex:1090,func:function(e){return e=e.replace(/(^|\d|V|I|X) ?в(в)?( |,|;|\n|$)/g,"$1 в$2.$3"),e.replace(/(^|\d|[IVX]) ?в\.? ?в\./g,"$1 вв.")}}),Typograf.rule({title:"Неразрывный пробел между числом и месяцем",name:"ru/nbsp/dayMonth",sortIndex:1105,func:function(e){var n=new RegExp("(\\d{1,2}) ("+this.data["ru/shortMonth"].join("|")+")","gi");return e.replace(n,"$1 $2")}}),Typograf.rule({title:"m2 → м², m3 → м³ и неразрывный пробел",name:"ru/nbsp/m",sortIndex:1030,func:function(e){var n="(км|м|дм|см|мм)",r=new RegExp("(^|\\D)(\\d+) ?"+n+"2(\\D|$)","g"),t=new RegExp("(^|\\D)(\\d+) ?"+n+"3(\\D|$)","g");return e.replace(r,"$1$2 $3²$4").replace(t,"$1$2 $3³$4")}}),Typograf.rule({title:"Неразрывный пробел после OOO, ОАО, ЗАО, НИИ и ПБОЮЛ",name:"ru/nbsp/ooo",sortIndex:1100,func:function(e){return e.replace(/(^|[^a-яёA-ЯЁ])(ООО|ОАО|ЗАО|НИИ|ПБОЮЛ) /g,"$1$2 ")}}),Typograf.rule({title:"Неразрывный пробел перед стр., гл., рис., илл.",name:"ru/nbsp/page",sortIndex:610,func:function(e){return e.replace(/ (стр|гл|рис|илл)\./g," $1.")}}),Typograf.rule({title:"Неразрывный пробел после XXXX г. (2012 г.)",name:"ru/nbsp/xxxx",sortIndex:1060,func:function(e){return e.replace(/(^|\D)(\d{1,4}) ?г(од| |,|;|\.|\n|$)/g,"$1$2 г$3")}}),Typograf.rule({title:"г.г. → гг. и неразрывный пробел",name:"ru/nbsp/yy",sortIndex:1080,func:function(e){return e.replace(/(^|\d) ?г\. ?г\./g,"$1 гг.")}}),Typograf.rule({title:"N-ый, -ой, -ая, -ое, -ые, -ым, -ом, -ых → N-й, -я, -е, -м, -х (25-й)",name:"ru/number/ordinals",sortIndex:1300,func:function(e){return e.replace(/(\d)-(ый|ой)([^а-яё]|$)/g,"$1-й$3").replace(/(\d)-ая([^а-яё]|$)/g,"$1-я$2").replace(/(\d)-(ое|ые)([^а-яё]|$)/g,"$1-е$3").replace(/(\d)-(ым|ом)([^а-яё]|$)/g,"$1-м$3").replace(/(\d)-ых([^а-яё]|$)/g,"$1-х$2").replace(/(\d)-ого([^а-яё]|$)/g,"$1-го$2").replace(/(\d)-ому([^а-яё]|$)/g,"$1-му$2").replace(/(\d)-ыми([^а-яё]|$)/g,"$1-ми$2")}}),Typograf.rule({title:"Висячая пунктуация для открывающей скобки",name:"ru/optalign/bracket",sortIndex:1001,func:function(e){return e.replace(/( |\u00A0)\(/g,'<span class="typograf-oa-sp-lbracket">$1</span><span class="typograf-oa-lbracket">(</span>').replace(/(^|\n)\(/g,'$1<span class="typograf-oa-n-lbracket">(</span>')},enabled:!1}).innerRule({name:"ru/optalign/bracket",func:function(e){return e.replace(/<span class="typograf-oa-(sp-lbracket|lbracket|n-lbracket)">(.*?)<\/span>/g,"$2")}}),Typograf.rule({title:"Висячая пунктуация для запятой",name:"ru/optalign/comma",sortIndex:1002,func:function(e){return e.replace(/([а-яёa-z0-9\u0301]+)\, /gi,'$1<span class="typograf-oa-comma">,</span><span class="typograf-oa-comma-sp"> </span>')},enabled:!1}).innerRule({name:"ru/optalign/comma",func:function(e){return e.replace(/<span class="typograf-oa-(comma|comma-sp)">(.*?)<\/span>/g,"$2")}}),Typograf.rule({title:"Висячая пунктуация для открывающей кавычки",name:"ru/optalign/quot",sortIndex:1e3,func:function(e){var n="("+this.setting("ru/punctuation/quot","lquot")+"|"+this.setting("ru/punctuation/quot","lquot2")+")",r=new RegExp("([a-zа-яё\\-́]{3,})( | )("+n+")","gi"),t=new RegExp("(^|\n|<p> *)"+n,"g");return e.replace(r,'$1<span class="typograf-oa-sp-lquot">$2</span><span class="typograf-oa-lquot">$3</span>').replace(t,'$1<span class="typograf-oa-n-lquot">$2</span>')},enabled:!1}).innerRule({name:"ru/optalign/quot",func:function(e){return e.replace(/<span class="typograf-oa-(sp-lquot|lquot|n-lquot)">(.*?)<\/span>/g,"$2")}}),Typograf.rule({title:"Расстановка кавычек",name:"ru/punctuation/quot",sortIndex:700,func:function(e,n){var r,t,a,o="[\\w\\dа-яёА-ЯЁ́]",u="(?:^|<\\w.*?>)*",i=n.lquot,c=n.rquot,l=n.lquot2,s=n.rquot2,p="(?:…|"+o+"|\\n)",g="(?:"+[o,"[)!?.:;#*,]"].join("|")+")*",f='(«|„|“|")',d='(»|”|“|")',m=new RegExp("("+u+")?"+f+"("+u+p+u+")","g"),$=new RegExp("("+u+g+u+")"+d+"("+g+")","g");return e=e.replace(m,"$1"+i+"$3").replace($,"$1"+c+"$3").replace(new RegExp("(^|\\w|\\s)"+c+i,"g"),"$1"+i+i),i===l&&c===s?e=e.replace(new RegExp(i+i,"g"),i).replace(new RegExp(c+c,"g"),c):(r=new RegExp("("+i+")([^"+c+"]*?)"+i+"(.*?)"+c+"([^"+i+"]*?)("+c+")","g"),t=new RegExp("("+l+")(.*?)"+i+"(.*?)("+s+")","g"),a=new RegExp("("+l+")(.*?)"+c+"(.*?)("+s+")","g"),e=e.replace(r,"$1$2"+l+"$3"+s+"$4$5").replace(t,"$1$2"+l+"$3$4").replace(a,"$1$2"+s+"$3$4")),e},settings:{lquot:"«",rquot:"»",lquot2:"„",rquot2:"“"}}),Typograf._sortRules(),Typograf._needSortRules=!0;