function Typograf(e){this._mode=0>e||e>2?0:e,this._settings={};for(var r in this._defaultSettings)this._defaultSettings.hasOwnProperty(r)&&(this._settings[r]=this._defaultSettings[r]);for(this._enabledRules={},r=0;r<this._rules.length;r++){var t=this._rules[r];this._enabledRules[t.name]=t.enabled}}Typograf.rule=function(e,r,t,a){Typograf.prototype._rules.push({name:e,sortIndex:r,callback:t,enabled:a!==!1}),Typograf._needSortRules&&this._sortRules()},Typograf.defaultSetting=function(e,r){Typograf.prototype._defaultSettings[e]=r},Typograf._sortRules=function(){Typograf.prototype._rules.sort(function(e,r){return e.sortIndex>r.sortIndex?1:-1})},Typograf.prototype={version:"0.3.0",setting:function(e,r){return 1===arguments.length?this._settings[e]:(this._settings[e]=r,this)},enabled:function(e){return this._enabledRules[e]},disabled:function(e){return!this._enabledRules[e]},enable:function(e){this._enabledRules[e]=!0},disable:function(e){this._enabledRules[e]=!1},execute:function(e){if(!e)return"";e=this._utfication(e),"function"==typeof this.onBefore&&(e=this.onBefore(e));for(var r=0;r<this._rules.length;r++){var t=this._rules[r];this.enabled(t.name)&&(e=t.callback.call(this,e))}return"function"==typeof this.onAfter&&(e=this.onAfter(e)),e=this._modification(e)},_defaultSettings:{},_rules:[],_utfication:function(e){for(var r=this.entities,t=0,a=r.length;a>t;t++){var n=r[t],u=new RegExp("("+n[0]+"|"+n[1]+")","g");e=e.replace(u,n[2])}return e},_modification:function(e){if(!this._mode)return e;for(var r,t=2===this._mode?1:0,a=this.entities,n=0,u=a.length;u>n;n++)r=new RegExp(a[n][2],"g"),e=e.replace(r,a[n][t]);return e}},Typograf.prototype.entities=[["\\&nbsp;","\\&\\#160;"," "],["\\&iexcl;","\\&\\#161;","¡"],["\\&cent;","\\&\\#162;","¢"],["\\&pound;","\\&\\#163;","£"],["\\&curren;","\\&\\#164;","¤"],["\\&yen;","\\&\\#165;","¥"],["\\&brvbar;","\\&\\#166;","¦"],["\\&sect;","\\&\\#167;","§"],["\\&uml;","\\&\\#168;","¨"],["\\&copy;","\\&\\#169;","©"],["\\&ordf;","\\&\\#170;","ª"],["\\&laquo;","\\&\\#171;","«"],["\\&not;","\\&\\#172;","¬"],["\\&shy;","\\&\\#173;","­"],["\\&reg;","\\&\\#174;","®"],["\\&macr;","\\&\\#175;","¯"],["\\&deg;","\\&\\#176;","°"],["\\&plusmn;","\\&\\#177;","±"],["\\&sup2;","\\&\\#178;","²"],["\\&sup3;","\\&\\#179;","³"],["\\&acute;","\\&\\#180;","´"],["\\&micro;","\\&\\#181;","µ"],["\\&para;","\\&\\#182;","¶"],["\\&middot;","\\&\\#183;","·"],["\\&cedil;","\\&\\#184;","¸"],["\\&sup1;","\\&\\#185;","¹"],["\\&ordm;","\\&\\#186;","º"],["\\&raquo;","\\&\\#187;","»"],["\\&frac14;","\\&\\#188;","¼"],["\\&frac12;","\\&\\#189;","½"],["\\&frac34;","\\&\\#190;","¾"],["\\&iquest;","\\&\\#191;","¿"],["\\&Agrave;","\\&\\#192;","À"],["\\&Aacute;","\\&\\#193;","Á"],["\\&Acirc;","\\&\\#194;","Â"],["\\&Atilde;","\\&\\#195;","Ã"],["\\&Auml;","\\&\\#196;","Ä"],["\\&Aring;","\\&\\#197;","Å"],["\\&AElig;","\\&\\#198;","Æ"],["\\&Ccedil;","\\&\\#199;","Ç"],["\\&Egrave;","\\&\\#200;","È"],["\\&Eacute;","\\&\\#201;","É"],["\\&Ecirc;","\\&\\#202;","Ê"],["\\&Euml;","\\&\\#203;","Ë"],["\\&Igrave;","\\&\\#204;","Ì"],["\\&Iacute;","\\&\\#205;","Í"],["\\&Icirc;","\\&\\#206;","Î"],["\\&Iuml;","\\&\\#207;","Ï"],["\\&ETH;","\\&\\#208;","Ð"],["\\&Ntilde;","\\&\\#209;","Ñ"],["\\&Ograve;","\\&\\#210;","Ò"],["\\&Oacute;","\\&\\#211;","Ó"],["\\&Ocirc;","\\&\\#212;","Ô"],["\\&Otilde;","\\&\\#213;","Õ"],["\\&Ouml;","\\&\\#214;","Ö"],["\\&times;","\\&\\#215;","×"],["\\&Oslash;","\\&\\#216;","Ø"],["\\&Ugrave;","\\&\\#217;","Ù"],["\\&Uacute;","\\&\\#218;","Ú"],["\\&Ucirc;","\\&\\#219;","Û"],["\\&Uuml;","\\&\\#220;","Ü"],["\\&Yacute;","\\&\\#221;","Ý"],["\\&THORN;","\\&\\#222;","Þ"],["\\&szlig;","\\&\\#223;","ß"],["\\&agrave;","\\&\\#224;","à"],["\\&aacute;","\\&\\#225;","á"],["\\&acirc;","\\&\\#226;","â"],["\\&atilde;","\\&\\#227;","ã"],["\\&auml;","\\&\\#228;","ä"],["\\&aring;","\\&\\#229;","å"],["\\&aelig;","\\&\\#230;","æ"],["\\&ccedil;","\\&\\#231;","ç"],["\\&egrave;","\\&\\#232;","è"],["\\&eacute;","\\&\\#233;","é"],["\\&ecirc;","\\&\\#234;","ê"],["\\&euml;","\\&\\#235;","ë"],["\\&igrave;","\\&\\#236;","ì"],["\\&iacute;","\\&\\#237;","í"],["\\&icirc;","\\&\\#238;","î"],["\\&iuml;","\\&\\#239;","ï"],["\\&eth;","\\&\\#240;","ð"],["\\&ntilde;","\\&\\#241;","ñ"],["\\&ograve;","\\&\\#242;","ò"],["\\&oacute;","\\&\\#243;","ó"],["\\&ocirc;","\\&\\#244;","ô"],["\\&otilde;","\\&\\#245;","õ"],["\\&ouml;","\\&\\#246;","ö"],["\\&divide;","\\&\\#247;","÷"],["\\&oslash;","\\&\\#248;","ø"],["\\&ugrave;","\\&\\#249;","ù"],["\\&uacute;","\\&\\#250;","ú"],["\\&ucirc;","\\&\\#251;","û"],["\\&uuml;","\\&\\#252;","ü"],["\\&yacute;","\\&\\#253;","ý"],["\\&thorn;","\\&\\#254;","þ"],["\\&yuml;","\\&\\#255;","ÿ"],["\\&fnof;","\\&\\#402;","ƒ"],["\\&Alpha;","\\&\\#913;","Α"],["\\&Beta;","\\&\\#914;","Β"],["\\&Gamma;","\\&\\#915;","Γ"],["\\&Delta;","\\&\\#916;","Δ"],["\\&Epsilon;","\\&\\#917;","Ε"],["\\&Zeta;","\\&\\#918;","Ζ"],["\\&Eta;","\\&\\#919;","Η"],["\\&Theta;","\\&\\#920;","Θ"],["\\&Iota;","\\&\\#921;","Ι"],["\\&Kappa;","\\&\\#922;","Κ"],["\\&Lambda;","\\&\\#923;","Λ"],["\\&Mu;","\\&\\#924;","Μ"],["\\&Nu;","\\&\\#925;","Ν"],["\\&Xi;","\\&\\#926;","Ξ"],["\\&Omicron;","\\&\\#927;","Ο"],["\\&Pi;","\\&\\#928;","Π"],["\\&Rho;","\\&\\#929;","Ρ"],["\\&Sigma;","\\&\\#931;","Σ"],["\\&Tau;","\\&\\#932;","Τ"],["\\&Upsilon;","\\&\\#933;","Υ"],["\\&Phi;","\\&\\#934;","Φ"],["\\&Chi;","\\&\\#935;","Χ"],["\\&Psi;","\\&\\#936;","Ψ"],["\\&Omega;","\\&\\#937;","Ω"],["\\&alpha;","\\&\\#945;","α"],["\\&beta;","\\&\\#946;","β"],["\\&gamma;","\\&\\#947;","γ"],["\\&delta;","\\&\\#948;","δ"],["\\&epsilon;","\\&\\#949;","ε"],["\\&zeta;","\\&\\#950;","ζ"],["\\&eta;","\\&\\#951;","η"],["\\&theta;","\\&\\#952;","θ"],["\\&iota;","\\&\\#953;","ι"],["\\&kappa;","\\&\\#954;","κ"],["\\&lambda;","\\&\\#955;","λ"],["\\&mu;","\\&\\#956;","μ"],["\\&nu;","\\&\\#957;","ν"],["\\&xi;","\\&\\#958;","ξ"],["\\&omicron;","\\&\\#959;","ο"],["\\&pi;","\\&\\#960;","π"],["\\&rho;","\\&\\#961;","ρ"],["\\&sigmaf;","\\&\\#962;","ς"],["\\&sigma;","\\&\\#963;","σ"],["\\&tau;","\\&\\#964;","τ"],["\\&upsilon;","\\&\\#965;","υ"],["\\&phi;","\\&\\#966;","φ"],["\\&chi;","\\&\\#967;","χ"],["\\&psi;","\\&\\#968;","ψ"],["\\&omega;","\\&\\#969;","ω"],["\\&thetasym;","\\&\\#977;","ϑ"],["\\&upsih;","\\&\\#978;","ϒ"],["\\&piv;","\\&\\#982;","ϖ"],["\\&bull;","\\&\\#8226;","•"],["\\&hellip;","\\&\\#8230;","…"],["\\&prime;","\\&\\#8242;","′"],["\\&Prime;","\\&\\#8243;","″"],["\\&oline;","\\&\\#8254;","‾"],["\\&frasl;","\\&\\#8260;","⁄"],["\\&weierp;","\\&\\#8472;","℘"],["\\&image;","\\&\\#8465;","ℑ"],["\\&real;","\\&\\#8476;","ℜ"],["\\&trade;","\\&\\#8482;","™"],["\\&alefsym;","\\&\\#8501;","ℵ"],["\\&larr;","\\&\\#8592;","←"],["\\&uarr;","\\&\\#8593;","↑"],["\\&rarr;","\\&\\#8594;","→"],["\\&darr;","\\&\\#8595;","↓"],["\\&harr;","\\&\\#8596;","↔"],["\\&crarr;","\\&\\#8629;","↵"],["\\&lArr;","\\&\\#8656;","⇐"],["\\&uArr;","\\&\\#8657;","⇑"],["\\&rArr;","\\&\\#8658;","⇒"],["\\&dArr;","\\&\\#8659;","⇓"],["\\&hArr;","\\&\\#8660;","⇔"],["\\&forall;","\\&\\#8704;","∀"],["\\&part;","\\&\\#8706;","∂"],["\\&exist;","\\&\\#8707;","∃"],["\\&empty;","\\&\\#8709;","∅"],["\\&nabla;","\\&\\#8711;","∇"],["\\&isin;","\\&\\#8712;","∈"],["\\&notin;","\\&\\#8713;","∉"],["\\&ni;","\\&\\#8715;","∋"],["\\&prod;","\\&\\#8719;","∏"],["\\&sum;","\\&\\#8721;","∑"],["\\&minus;","\\&\\#8722;","−"],["\\&lowast;","\\&\\#8727;","∗"],["\\&radic;","\\&\\#8730;","√"],["\\&prop;","\\&\\#8733;","∝"],["\\&infin;","\\&\\#8734;","∞"],["\\&ang;","\\&\\#8736;","∠"],["\\&and;","\\&\\#8743;","∧"],["\\&or;","\\&\\#8744;","∨"],["\\&cap;","\\&\\#8745;","∩"],["\\&cup;","\\&\\#8746;","∪"],["\\&int;","\\&\\#8747;","∫"],["\\&there4;","\\&\\#8756;","∴"],["\\&sim;","\\&\\#8764;","∼"],["\\&cong;","\\&\\#8773;","≅"],["\\&asymp;","\\&\\#8776;","≈"],["\\&ne;","\\&\\#8800;","≠"],["\\&equiv;","\\&\\#8801;","≡"],["\\&le;","\\&\\#8804;","≤"],["\\&ge;","\\&\\#8805;","≥"],["\\&sub;","\\&\\#8834;","⊂"],["\\&sup;","\\&\\#8835;","⊃"],["\\&nsub;","\\&\\#8836;","⊄"],["\\&sube;","\\&\\#8838;","⊆"],["\\&supe;","\\&\\#8839;","⊇"],["\\&oplus;","\\&\\#8853;","⊕"],["\\&otimes;","\\&\\#8855;","⊗"],["\\&perp;","\\&\\#8869;","⊥"],["\\&sdot;","\\&\\#8901;","⋅"],["\\&lceil;","\\&\\#8968;","⌈"],["\\&rceil;","\\&\\#8969;","⌉"],["\\&lfloor;","\\&\\#8970;","⌊"],["\\&rfloor;","\\&\\#8971;","⌋"],["\\&lang;","\\&\\#9001;","〈"],["\\&rang;","\\&\\#9002;","〉"],["\\&spades;","\\&\\#9824;","♠"],["\\&clubs;","\\&\\#9827;","♣"],["\\&hearts;","\\&\\#9829;","♥"],["\\&diams;","\\&\\#9830;","♦"],["\\&loz;","\\&\\#9674;","◊"],["\\&OElig;","\\&\\#338;","Œ"],["\\&oelig;","\\&\\#339;","œ"],["\\&Scaron;","\\&\\#352;","Š"],["\\&scaron;","\\&\\#353;","š"],["\\&Yuml;","\\&\\#376;","Ÿ"],["\\&circ;","\\&\\#710;","ˆ"],["\\&tilde;","\\&\\#732;","˜"],["\\&ensp;","\\&\\#8194;"," "],["\\&emsp;","\\&\\#8195;"," "],["\\&thinsp;","\\&\\#8201;"," "],["\\&zwnj;","\\&\\#8204;","‌"],["\\&zwj;","\\&\\#8205;","‍"],["\\&lrm;","\\&\\#8206;","‎"],["\\&rlm;","\\&\\#8207;","‏"],["\\&ndash;","\\&\\#8211;","–"],["\\&mdash;","\\&\\#8212;","—"],["\\&lsquo;","\\&\\#8216;","‘"],["\\&rsquo;","\\&\\#8217;","’"],["\\&sbquo;","\\&\\#8218;","‚"],["\\&ldquo;","\\&\\#8220;","“"],["\\&rdquo;","\\&\\#8221;","”"],["\\&bdquo;","\\&\\#8222;","„"],["\\&dagger;","\\&\\#8224;","†"],["\\&Dagger;","\\&\\#8225;","‡"],["\\&permil;","\\&\\#8240;","‰"],["\\&lsaquo;","\\&\\#8249;","‹"],["\\&rsaquo;","\\&\\#8250;","›"],["\\&euro;","\\&\\#8364;","€"]],Typograf.rule("but",1110,function(e){var r=new RegExp("([,])?( | |\n)(а|но)( | |\n)","g");return e.replace(r,",$2$3$4")}),Typograf.rule("c",1020,function(e){var r=new RegExp('(\\d+)( | )?(C|F)([\\W \\.,:\\!\\?"\\]\\)]|$)',"g");return e.replace(r,"$1 °$3$4")}),Typograf.rule("cc",1090,function(e){return e.replace(/^в\. ?в\./g,"вв.").replace(/ ?в\. ?в\./g," вв.")}),Typograf.rule("century",1070,function(e){return e.replace(/(\d+) ?в( |,|;|\.|\n|$)/g,"$1 в$2").replace(/(V|I|X) ?в(в)?( |,|;|\.|\n|$)/g,"$1 в$2$3")}),Typograf.rule("copy",10,function(e){return e.replace(/\(r\)/gi,"®").replace(/\((c|с)\)/gi,"©").replace(/\(tm\)/gi,"™").replace(/\+\/\-/gi,"±")}),Typograf.rule("fraction",1120,function(e){return e.replace(/(^|\D)1\/2(\D|$)/g,"$1½$2").replace(/(^|\D)1\/4(\D|$)/g,"$1¼$2").replace(/(^|\D)3\/4(\D|$)/g,"$1¾$2")}),Typograf.rule("hellip",20,function(e){return e.replace(/(^|[^.])\.{3}([^.]|$)/g,"$1…$2")}),function(){var e="(^| |\\n)",r="( |,|\\.|\\?|\\:|\\!|$)";Typograf.rule("to",30,function(e){var t=new RegExp("( | ?- ?)(то|либо|нибудь|ка|де|кась)"+r,"g");return e.replace(t,"-$2$3")}),Typograf.rule("izza",33,function(t){var a=new RegExp(e+"(И|и)з за"+r,"g");return t.replace(a,"$1$2з-за$3")}),Typograf.rule("izpod",35,function(t){var a=new RegExp(e+"(И|и)з под"+r,"g");return t.replace(a,"$1$2з-под$3")}),Typograf.rule("koe",38,function(t){var a=new RegExp(e+"(К|к)ое "+r,"g");t=t.replace(a,"$1$2ое-$3");var n=new RegExp(e+"(К|к)ой "+r,"g");return t.replace(n,"$1$2ой-$3")})}(),Typograf.rule("m2",1030,function(e){var r="(км|м|дм|см|мм)",t=new RegExp("(^|\\D)(\\d+) ?"+r+"2(\\D|$)","g");return e.replace(t,"$1$2 $3²$4")}),Typograf.rule("m3",1040,function(e){var r="(км|м|дм|см|мм)",t=new RegExp("(^|\\D)(\\d+) ?"+r+"3(\\D|$)","g");return e.replace(t,"$1$2 $3³$4")}),Typograf.rule("nbr",710,function(e){return e.replace(/\n/g,"|<br/>")},!1),Typograf.rule("ooo",1100,function(e){return e.replace(/(ООО|ОАО) /g,"$1 ")}),Typograf.rule("pbr",700,function(e){return-1!==e.search(/\n/)?(e="<p>"+e.replace(/\n\n/g,"</p>\n<p>")+"</p>",e=e.replace(/([^>])\n/g,"$1<br />\n")):e="<p>"+e+"</p>",e},!1),Typograf.rule("plus_minus",1010,function(e){var r=new RegExp("(^| |\\>|\x00uA0)\\+-(\\d)","g");return e.replace(r,"$1±$2")}),Typograf.rule("quot",700,function(e){return e}),Typograf.defaultSetting("quot11","«"),Typograf.defaultSetting("quot12","»"),Typograf.defaultSetting("quot21","„"),Typograf.defaultSetting("quot22","“"),Typograf.rule("times",1050,function(e){return e.replace(/(\d) ?(x|х) ?(\d)/g,"$1×$3")}),Typograf.rule("url",200,function(e){var r="(http|https|ftp|telnet|news|gopher|file|wais)://",t="([a-zA-Z0-9/\\n+-=%&:_.~?]+[a-zA-Z0-9#+]*)",a=new RegExp(r+t,"g");return e.replace(a,'<a href="$1://$2">$1://$2</a>')}),Typograf.rule("xxxx",1060,function(e){return e.replace(/(^|\D)(\d{4}) ?г( |,|;|\.|\n|$)/g,"$1$2 г$3")}),Typograf.rule("yy",1080,function(e){return e.replace(/^г\. ?г\./g,"гг.").replace(/ ?г\. ?г\./g," гг.")}),Typograf.rule("dash",620,function(e){var r=new RegExp("( | )(-|—)( |\\n)","g");return e.replace(r," —$3").replace(/(X|I|V) ?- ?(X|I|V)/g,"$1—$2")}),Typograf.defaultSetting("dashInterval","—"),Typograf.defaultSetting("dash","—"),Typograf.rule("dash_month",610,function(e){var r="(январь|февраль|март|апрель|июнь|июль|август|сентябрь|октябрь|ноябрь|декабрь)",t=new RegExp(r+" ?(-|—) ?"+r,"gi");return e.replace(t,"$1"+this.setting("dashInterval")+"$3")}),Typograf.rule("dash_weekday",600,function(e){var r=this.setting("dashInterval"),t="(понедельник|вторник|среда|четверг|пятница|суббота|воскресенье)",a=new RegExp(t+" ?(-|—) ?"+t,"gi");return e.replace(a,"$1—$3").replace(/(^|\n|>) ?(-|—) /g,"$1— ").replace(/(^|[^\d\-])(\d{1,4}) ?(-|—) ?(\d{1,4})([^\d\-\=]|$)/g,"$1$2"+r+"$4$5")}),Typograf.rule("-space_before",500,function(e){return e.replace(/\r/g,"")}),Typograf.rule("del_double_punctiation",580,function(e){return e.replace(/(,|\.|\:|\!|\?){2,}/g,"$1")}),Typograf.rule("del_repeat_space",540,function(e){return e.replace(/ {2,}/g," ").replace(/\n {1,}/g,"\n").replace(/\n{3,}/g,"\n\n")}),Typograf.rule("del_space_before_percent",600,function(e){return e.replace(/ %/g,"%")}),Typograf.rule("del_space_before_punctuation",550,function(e){return e.replace(/ (\!|;|,|\?|\.|\:)/g,"$1").replace(/\( /g,"(").replace(/([^ ])\(/g,"$1 (").replace(/ \)/g,")").replace(/\)([^\!;,\?\.\:])/g,") $1")}),Typograf.rule("pasteSpaceAfterPunctuation",560,function(e){return e.replace(/(\!|;|\?)([^ \n\t\!;\?])/g,"$1 $2").replace(/(\D)(,|\:)([^ \/\d\n\t\!;,\?\.\:])/g,"$1$2 $3")}),Typograf.rule("replace_tab",510,function(e){return e.replace(/\t/g," ")}),Typograf.rule("space_after_num",610,function(e){return e.replace(/№(\d)/g,"№ $1").replace(/§(\d|I|V|X)/g,"§ $1")}),Typograf.rule("space_after_short_word",590,function(e){var r=this.setting("lengthShortWord"),t=new RegExp("( [а-яА-Я\\w]{1,"+r+"}) ","g");return r>0?e.replace(t,"$1 "):e}),Typograf.defaultSetting("lengthShortWord",2),Typograf.rule("space_before_last_word",620,function(e){var r=this.setting("lengthLastWord"),t=new RegExp("( )([а-яА-Я\\w]{1,"+r+"})(\\.|\\?|:|\\!|,)","g");return r>0?e.replace(t," $2$3"):e}),Typograf.setting("lengthLastWord",3),Typograf.rule("space_before_particle",570,function(e){return e.replace(/ (ли|ль|же|ж|бы|б)([^а-яА-Я])/g," $1$2")}),Typograf.rule("trim",530,function(e){return e.trim()}),Typograf._sortRules(),Typograf._needSortRules=!0;