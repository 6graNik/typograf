function Typograf(e){this._prefs="object"==typeof e?e:{},this._settings={},Object.keys(this._defaultSettings).forEach(function(e){this._settings[e]=this._defaultSettings[e]},this),this._enabledRules={},this._rules.forEach(function(e){this._enabledRules[e.name]=e.enabled},this)}Typograf.rule=function(e){e.enabled=e.enabled===!1?!1:!0,Typograf.prototype._rules.push(e),Typograf._needSortRules&&this._sortRules()},Typograf.defaultSetting=function(e,n){Typograf.prototype._defaultSettings[e]=n},Typograf._sortRules=function(){Typograf.prototype._rules.sort(function(e,n){return e.sortIndex>n.sortIndex?1:-1})},Typograf.prototype={constructor:Typograf,execute:function(e){if(!e)return"";var n=-1!==e.search(/<|>/);return n&&(e=this._hideTags(e)),e=this._utfication(e),this._rules.forEach(function(n){this.enabled(n.name)&&(e=n.callback.call(this,e))},this),e=this._modification(e),n&&(e=this._showTags(e)),e},setting:function(e,n){return 1===arguments.length?this._settings[e]:(this._settings[e]=n,this)},enabled:function(e){return this._enabledRules[e]},disabled:function(e){return!this._enabledRules[e]},enable:function(e){return this._enable(e,!0),this},disable:function(e){return this._enable(e,!1),this},_enable:function(e,n){Array.isArray(e)?e.forEach(function(e){this._enabledRules[e]=n},this):this._enabledRules[e]=n},_defaultSettings:{},_rules:[],_hideTags:function(e){this._hiddenTags={};var n=this,t="",r=[["<!--","-->"],["<pre[^>]*>","<\\/pre>"],["<code[^>]*>","<\\/code>"],["<style[^>]*>","<\\/style>"],["<script[^>]*>","<\\/script>"],["<object>","<\\/object>"]];r.forEach(function(e){t+="("+e[0]+"(.|\\n)*?"+e[1]+")|"},this);var a=0;return e=e.replace(new RegExp("("+t+"<[^>]*[\\s][^>]*>)","gim"),function(e){var t="__typograf"+a+"__";return n._hiddenTags[t]=e,a++,t})},_showTags:function(e){return Object.keys(this._hiddenTags).forEach(function(n){e=e.replace(new RegExp(n,"gim"),this._hiddenTags[n])},this),delete this._hiddenTags,e},_utfication:function(e){return this.entities.forEach(function(n){var t=new RegExp("("+n[0]+"|"+n[1]+")","g");e=e.replace(t,n[2])},this),e},_modification:function(e){var n,t=this._prefs.mode;return("name"===t||"digit"===t)&&(n="name"===t?0:1,this.entities.forEach(function(t){var r=new RegExp(t[2],"g");e=e.replace(r,t[n])},this)),e}},"object"==typeof exports&&(module.exports=Typograf),Typograf.rule({title:"-> → →, <- → ←",name:"arrow",sortIndex:1130,func:function(e){return e.replace(/->[^>]/g,"→").replace(/[^<]<-/g,"←")}}),Typograf.rule({title:"Добавление ° к C и F",name:"cf",sortIndex:1020,func:function(e){var n=new RegExp('(\\d+)( | )?(C|F)([\\W \\.,:\\!\\?"\\]\\)]|$)',"g");return e.replace(n,"$1 °$3$4")}}),Typograf.rule({title:"Удаление лишних точек и пробелов в вв.",name:"cc",sortIndex:1090,func:function(e){return e=e.replace(/(^|\d|V|I|X) ?в(в)?( |,|;|\n|$)/g,"$1 в$2.$3"),e.replace(/(^|\d|[IVX]) ?в\.? ?в\./g,"$1 вв.")}}),Typograf.rule({title:"(c) → ©, (tm) → ©, (r) → ™",name:"copy",sortIndex:10,func:function(e){return e.replace(/\(r\)/gi,"®").replace(/\((c|с)\)/gi,"©").replace(/\(tm\)/gi,"™")}}),Typograf.rule({title:"Удаление двойной пунктуации",name:"del_double_punctiation",sortIndex:580,func:function(e){return e.replace(/(,|\.|\:|\!|\?){2,}/g,"$1")}}),Typograf.rule({title:"1/2 → ½, 1/4 → ¼, 3/3 → ¾",name:"fraction",sortIndex:1120,func:function(e){return e.replace(/(^|\D)1\/2(\D|$)/g,"$1½$2").replace(/(^|\D)1\/4(\D|$)/g,"$1¼$2").replace(/(^|\D)3\/4(\D|$)/g,"$1¾$2")}}),Typograf.rule({title:"... → …",name:"hellip",sortIndex:20,func:function(e){return e.replace(/(^|[^.])\.{3,4}([^.]|$)/g,"$1…$2")}}),Typograf.rule({title:"Замена перевода строки на <br/>",name:"nbr",sortIndex:710,func:function(e){return e.replace(/\n/g,"|<br/>")},enabled:!1}),Typograf.rule({title:"Расстановка <p> и <br/>",name:"pbr",sortIndex:700,func:function(e){return-1!==e.search(/\n/)?(e="<p>"+e.replace(/\n\n/g,"</p>\n<p>")+"</p>",e=e.replace(/([^>])\n/g,"$1<br />\n")):e="<p>"+e+"</p>",e},enabled:!1}),Typograf.rule({title:"+- → ±",name:"plus_minus",sortIndex:1010,func:function(e){var n=new RegExp("(^| |\\>|\x00uA0)\\+-(\\d)","g");return e.replace(n,"$1±$2")}}),Typograf.rule({title:"Расстановка кавычек",name:"quot",sortIndex:700,func:function(e){return e}}),Typograf.defaultSetting("quot11","«"),Typograf.defaultSetting("quot12","»"),Typograf.defaultSetting("quot21","„"),Typograf.defaultSetting("quot22","“"),Typograf.rule({title:"x → ×",name:"times",sortIndex:1050,func:function(e){return e.replace(/(\d) ?(x|х) ?(\d)/g,"$1×$3")}}),Typograf.rule({title:"Расстановка ссылок",name:"url",sortIndex:200,func:function(e){var n="(http|https|ftp|telnet|news|gopher|file|wais)://",t="([a-zA-Z0-9/\\n+-=%&:_.~?]+[a-zA-Z0-9#+]*)",r=new RegExp(n+t,"g");return e.replace(r,'<a href="$1://$2">$1://$2</a>')}}),Typograf.rule({title:"Дефис на тире",name:"dash",sortIndex:620,func:function(e){var n=new RegExp("( | )(-|—)( |\\n)","g");return e.replace(n," —$3").replace(/(X|I|V) ?- ?(X|I|V)/g,"$1—$2")}}),Typograf.defaultSetting("dashInterval","—"),Typograf.defaultSetting("dash","—"),function(){var e="(^| |\\n)",n="( |,|\\.|\\?|\\:|\\!|$)";Typograf.rule({title:"Дефис перед то, либо, нибудь, ка, де, кась",name:"dash:to",sortIndex:30,func:function(e){var t=new RegExp("( | ?- ?)(то|либо|нибудь|ка|де|кась)"+n,"g");return e.replace(t,"-$2$3")}}),Typograf.rule({title:"Дефис между из-за",name:"dash:izza",sortIndex:33,func:function(t){var r=new RegExp(e+"(И|и)з за"+n,"g");return t.replace(r,"$1$2з-за$3")}}),Typograf.rule({title:"Дефис между из-под",name:"dash:izpod",sortIndex:35,func:function(t){var r=new RegExp(e+"(И|и)з под"+n,"g");return t.replace(r,"$1$2з-под$3")}}),Typograf.rule({title:"Дефис после кое и кой",name:"dash:koe",sortIndex:38,func:function(t){var r=new RegExp(e+"(К|к)ое\\s([а-я]{3,})"+n,"g");t=t.replace(r,"$1$2ое-$3$4");var a=new RegExp(e+"(К|к)ой\\s([а-я]{3,})"+n,"g");return t.replace(a,"$1$2ой-$3$4")}}),Typograf.rule({title:"Дефис между верно-таки и т.д.",name:"dash:taki",sortIndex:39,func:function(e){var t=new RegExp("(верно|довольно|опять|прямо|так|всё|действительно|неужели)\\s(таки)"+n,"g");return e.replace(t,"$1-$2$3")}})}(),Typograf.rule({title:"Дефис между месяцами",name:"dash:month",sortIndex:610,func:function(e){var n="(январь|февраль|март|апрель|июнь|июль|август|сентябрь|октябрь|ноябрь|декабрь)",t=new RegExp(n+" ?(-|—) ?"+n,"gi");return e.replace(t,"$1"+this.setting("dashInterval")+"$3")}}),Typograf.rule({title:"Дефис между днями недели",name:"dash:weekday",sortIndex:600,func:function(e){var n=this.setting("dashInterval"),t="(понедельник|вторник|среда|четверг|пятница|суббота|воскресенье)",r=new RegExp(t+" ?(-|—) ?"+t,"gi");return e.replace(r,"$1—$3").replace(/(^|\n|>) ?(-|—) /g,"$1— ").replace(/(^|[^\d\-])(\d{1,4}) ?(-|—) ?(\d{1,4})([^\d\-\=]|$)/g,"$1$2"+n+"$4$5")}}),Typograf.rule({title:"Неразрывный пробел после № и §",name:"nbsp:after_num",sortIndex:610,func:function(e){return e.replace(/№(\d)/g,"№ $1").replace(/§(\d|I|V|X)/g,"§ $1")}}),Typograf.rule({title:"Неразрывный пробел перед ли, ль, же, бы, б",name:"nbsp:before_particle",sortIndex:570,func:function(e){return e.replace(/ (ли|ль|же|ж|бы|б)([^а-яА-Я])/g," $1$2")}}),Typograf.rule({title:"Неразрывный пробел перед последним коротким словом в предложении",name:"nbsp:before_last_word",sortIndex:620,func:function(e){var n=this.setting("lengthLastWord"),t=new RegExp("( )([а-яА-Я\\w]{1,"+n+"})(\\.|\\?|:|\\!|,)","g");return n>0?e.replace(t," $2$3"):e}}),Typograf.defaultSetting("lengthLastWord",3),Typograf.rule({title:"Расстановка запятых и неразрывного пробела перед а и но",name:"nbsp:but",sortIndex:1110,func:function(e){var n=new RegExp("([,])?( | |\n)(а|но)( | |\n)","g");return e.replace(n,",$2$3$4")}}),Typograf.rule({title:"m2 → м², m3 → м³ и неразрывный пробел",name:"nbsp:m",sortIndex:1030,func:function(e){var n="(км|м|дм|см|мм)",t=new RegExp("(^|\\D)(\\d+) ?"+n+"2(\\D|$)","g"),r=new RegExp("(^|\\D)(\\d+) ?"+n+"3(\\D|$)","g");return e=e.replace(t,"$1$2 $3²$4"),e.replace(r,"$1$2 $3³$4")}}),Typograf.rule({title:"Неразрывный пробел после OOO или ОАО",name:"nbsp:ooo",sortIndex:1100,func:function(e){return e.replace(/(ООО|ОАО) /g,"$1 ")}}),Typograf.rule({title:"Неразрывный пробел после XXXX",name:"nbsp:xxxx",sortIndex:1060,func:function(e){return e.replace(/(^|\D)(\d{4}) ?г( |,|;|\.|\n|$)/g,"$1$2 г$3")}}),Typograf.rule({title:"г.г. → гг. и неразрывный пробел",name:"nbsp:yy",sortIndex:1080,func:function(e){return e.replace(/(^| )г\. ?г\./g," гг.")}}),Typograf.rule({title:"Пробел после знаков пунктуации",name:"space:after_punctuation",sortIndex:560,func:function(e){return e.replace(/(\!|;|\?)([^ \n\t\!;\?])/g,"$1 $2").replace(/(\D)(,|\:)([^ \/\d\n\t\!;,\?\.\:])/g,"$1$2 $3")}}),Typograf.rule({name:"-space:before",sortIndex:500,func:function(e){return e.replace(/\r/g,"")}}),Typograf.rule({title:"Удаление пробела перед %",name:"space:del_before_percent",sortIndex:600,func:function(e){return e.replace(/\d( |\u0A00)%/g,"%")}}),Typograf.rule({title:"Удаление пробелов перед знаками пунктуации",name:"space:del_before_punctuation",sortIndex:550,func:function(e){return e.replace(/ (\!|;|,|\?|\.|\:)/g,"$1").replace(/\( /g,"(").replace(/([^ ])\(/g,"$1 (").replace(/ \)/g,")").replace(/\)([^\!;,\?\.\:])/g,") $1")}}),Typograf.rule({title:"Удаление повторяющихся пробелов",name:"space:del_repeat_space",sortIndex:540,func:function(e){return e.replace(/ {2,}/g," ").replace(/\n {1,}/g,"\n").replace(/\n{3,}/g,"\n\n")}}),Typograf.rule({title:"Замена табов на пробелы",name:"space:replace_tab",sortIndex:510,func:function(e){return e.replace(/\t/g," ")}}),Typograf.rule({title:"Удаление пробелов в начале и в конце текста",name:"space:trim",sortIndex:530,func:function(e){return e.trim()}}),Typograf._sortRules(),Typograf._needSortRules=!0;